<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Freds</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      background-color: #f0f0f0; /* Light gray background */
      font-family: Arial, sans-serif;
    }
    .container {
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 36px;
      color: #444;
    }
    h2 {
      font-size: 24px;
      color: #666;
      margin-bottom: 20px;
    }
    .fred-item {
      display: flex;
      flex-direction: column; /* Stack elements vertically */
      align-items: center;
      background: white; /* White background for thread items */
      border: 1px solid #ccc; /* Light border */
      border-radius: 8px; /* Rounded corners */
      padding: 10px;
      margin: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Subtle shadow */
      transition: transform 0.2s; /* Animation for hover */
      cursor: pointer;
    }
    .fred-item:hover {
      transform: translateY(-2px); /* Lift effect on hover */
      box-shadow: 0 4px 10px rgba(0,0,0,0.2); /* Stronger shadow on hover */
    }
    .fred-image {
      width: 100%; /* Full width */
      height: auto; /* Maintain aspect ratio */
      border-radius: 8px; /* Rounded corners */
      max-height: 150px; /* Limit height */
      object-fit: cover; /* Cover image */
      margin-bottom: 10px; /* Spacing below image */
    }
    .recent-comment {
      font-size: 14px; /* Smaller font for recent comment */
      color: #777; /* Gray color for text */
      text-align: left; /* Align text to the left */
      width: 100%; /* Full width */
      margin-top: 5px; /* Spacing above recent comment */
    }
    .comment-name {
      font-weight: bold; /* Bold for name */
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Freds</h1>
    <h2>Select a Fred:</h2>
    
    <div id="threadsList"></div> <!-- Container for threads -->

  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBCzabBMFxms9HfX0N411uJQYjEzspSnVk",
      authDomain: "the-virgin-games.firebaseapp.com",
      projectId: "the-virgin-games",
      storageBucket: "the-virgin-games.appspot.com",
      messagingSenderId: "1092738842373",
      appId: "1:1092738842373:web:8bb210d9fb815cc5ae016c"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const threads = [
      { name: "Chapter 1 fred", url: "chapter1fred.html", imageUrl: "YOUR_IMAGE_URL_FOR_CHAPTER_1" },
      { name: "Chapter 2 fred", url: "chapter2fred.html", imageUrl: "YOUR_IMAGE_URL_FOR_CHAPTER_2" },
      { name: "Chapter 3 fred", url: "chapter3fred.html", imageUrl: "YOUR_IMAGE_URL_FOR_CHAPTER_3" },
      { name: "Chapter 4 fred", url: "chapter4fred.html", imageUrl: "YOUR_IMAGE_URL_FOR_CHAPTER_4" },
      { name: "Chapter 5 fred", url: "chapter5fred.html", imageUrl: "YOUR_IMAGE_URL_FOR_CHAPTER_5" },
      { name: "Epilogue fred", url: "epiloguefred.html", imageUrl: "YOUR_IMAGE_URL_FOR_EPILOGUE" },
    ];

    // Function to fetch the most recent comment
    async function fetchRecentComment(threadName) {
      const commentsRef = doc(db, threadName, 'comments'); // Update with your actual path
      const docSnap = await getDoc(commentsRef);
      
      if (docSnap.exists()) {
        const comments = docSnap.data().comments || [];
        // Get the most recent comment based on timestamp
        if (comments.length > 0) {
          const recentComment = comments.sort((a, b) => b.timestamp - a.timestamp)[0]; // Sort and get the latest
          return { text: recentComment.text, name: recentComment.name || "Anonymous" };
        }
      }
      return { text: "No comments yet", name: "" }; // Default message if no comments
    }

    // Render threads with recent comments
    async function renderThreads() {
      const threadsList = document.getElementById('threadsList');

      for (const thread of threads) {
        const recentComment = await fetchRecentComment(thread.name); // Fetch recent comment for each thread

        const threadElement = document.createElement('div');
        threadElement.className = 'fred-item';
        threadElement.onclick = () => window.location.href = thread.url; // Redirect to thread URL

        // Create the image element
        const imageElement = document.createElement('img');
        imageElement.src = thread.imageUrl; // Set image URL
        imageElement.alt = thread.name; // Alt text for the image
        imageElement.className = 'fred-image'; // Add class for styling

        // Create the comment label
        const commentElement = document.createElement('div');
        commentElement.className = 'recent-comment';
        commentElement.innerHTML = `<span class="comment-name">${recentComment.name}:</span> ${recentComment.text.length > 17 ? recentComment.text.substring(0, 17) + "..." : recentComment.text}`; // Shorten comment if necessary

        // Append image and comment to the thread element
        threadElement.appendChild(imageElement);
        threadElement.appendChild(commentElement);

        // Append the thread element to the threads list
        threadsList.appendChild(threadElement);
      }
    }

    renderThreads(); // Call the function to render threads
  </script>

  <!-- Navigation Button to Home Page -->
  <a href="index.html" style="position: fixed; top: 10px; left: 10px; z-index: 1000;">
      <img src="https://i.imgur.com/AmjEU0x.png" alt="Home" style="width: 40px; height: 40px;">
  </a>
</body>
</html>
